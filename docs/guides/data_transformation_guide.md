# ğŸ”„ ë°ì´í„° ë³€í™˜ ê°€ì´ë“œ: ì›ë³¸ â†’ ìµœì í™” ë°ì´í„°ì…‹

## ğŸ“Š ê°œìš”

ì´ ë¬¸ì„œëŠ” ì›ë³¸ ë¹„íŠ¸ì½”ì¸ íŠ¸ëœì­ì…˜ ë°ì´í„°(`1000btc.csv`)ì—ì„œ ê³ ë˜ ë¶„ë¥˜ìš© ìµœì í™” ë°ì´í„°ì…‹(`optimized_whale_dataset.csv`)ìœ¼ë¡œì˜ ë³€í™˜ ê³¼ì •ì„ ìƒì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ—ï¸ ë¹„íŠ¸ì½”ì¸ íŠ¸ëœì­ì…˜ êµ¬ì¡°ì™€ ë°ì´í„° ì—°ê´€ê´€ê³„

### ğŸ’° ë¹„íŠ¸ì½”ì¸ íŠ¸ëœì­ì…˜ ê¸°ë³¸ êµ¬ì¡°

```
íŠ¸ëœì­ì…˜ = {
    ì…ë ¥ë“¤(Inputs) â†’ [Address1: 500 BTC, Address2: 300 BTC, ...]
                   â†“
    ì¶œë ¥ë“¤(Outputs) â†’ [Address3: 200 BTC, Address4: 150 BTC, Address5: 449 BTC]
                    â†“
    ìˆ˜ìˆ˜ë£Œ(Fee) = ì´ì…ë ¥ - ì´ì¶œë ¥ = 1 BTC
}
```

### ğŸ“‹ ì›ë³¸ ë°ì´í„° ì»¬ëŸ¼ ìƒì„¸ ì„¤ëª…

| ì»¬ëŸ¼ëª…               | ì„¤ëª…                     | íŠ¸ëœì­ì…˜ ì—°ê´€ë„ | ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ë¯¸                        |
| -------------------- | ------------------------ | --------------- | ------------------------------------ |
| `tx_hash`            | íŠ¸ëœì­ì…˜ ê³ ìœ  í•´ì‹œê°’     | **1.0**         | ë¸”ë¡ì²´ì¸ìƒ íŠ¸ëœì­ì…˜ ì‹ë³„ì           |
| `block_timestamp`    | ë¸”ë¡ ìƒì„± ì‹œê°„           | **1.0**         | íŠ¸ëœì­ì…˜ ë°œìƒ ì‹œì                    |
| `input_count`        | ì…ë ¥ ì£¼ì†Œ ê°œìˆ˜           | **1.0**         | ì–¼ë§ˆë‚˜ ë§ì€ ì£¼ì†Œì—ì„œ ëˆì„ ëª¨ì•˜ëŠ”ê°€   |
| `output_count`       | ì¶œë ¥ ì£¼ì†Œ ê°œìˆ˜           | **1.0**         | ì–¼ë§ˆë‚˜ ë§ì€ ì£¼ì†Œë¡œ ëˆì„ ë³´ëƒˆëŠ”ê°€     |
| `total_input_value`  | ì´ ì…ë ¥ ê¸ˆì•¡ (satoshi)   | **1.0**         | ëª¨ë“  ì…ë ¥ì˜ í•©ê³„                     |
| `total_output_value` | ì´ ì¶œë ¥ ê¸ˆì•¡ (satoshi)   | **1.0**         | ëª¨ë“  ì¶œë ¥ì˜ í•©ê³„                     |
| `fee`                | ìˆ˜ìˆ˜ë£Œ (satoshi)         | **1.0**         | `total_input - total_output`         |
| `max_output_value`   | ìµœëŒ€ ì¶œë ¥ ê¸ˆì•¡ (satoshi) | **1.0**         | ê°€ì¥ í° ì¶œë ¥ ê¸ˆì•¡                    |
| `max_input_value`    | ìµœëŒ€ ì…ë ¥ ê¸ˆì•¡ (satoshi) | **1.0**         | ê°€ì¥ í° ì…ë ¥ ê¸ˆì•¡                    |
| `max_output_ratio`   | ìµœëŒ€ ì¶œë ¥ ë¹„ìœ¨           | **0.9**         | `max_output / total_output` (ì§‘ì¤‘ë„) |
| `fee_per_max_ratio`  | ìˆ˜ìˆ˜ë£Œ/ìµœëŒ€ì¶œë ¥ ë¹„ìœ¨     | **0.7**         | íŒŒìƒ ì§€í‘œ                            |

### ğŸ¯ ê±°ë˜ í–‰ë™ íŒ¨í„´ í•´ì„

#### 1. **ìˆ˜ì§‘í˜• ê³ ë˜** (Collector Whale)

```
Input ë§ìŒ + Output ì ìŒ = ì—¬ëŸ¬ ê³³ì—ì„œ ëª¨ì•„ì„œ í•œ ê³³ìœ¼ë¡œ
[A:100â‚¿][B:200â‚¿][C:300â‚¿] â†’ [D:599â‚¿] + 1â‚¿ ìˆ˜ìˆ˜ë£Œ
```

- **ì—°ê´€ë„**: `input_count` (1.0), `output_count` (1.0)
- **ì˜ë¯¸**: ë¶„ì‚°ëœ ìì‚°ì„ ì§‘ì¤‘ì‹œí‚¤ëŠ” íŒ¨í„´

#### 2. **ë¶„ì‚°í˜• ê³ ë˜** (Distributor Whale)

```
Input ì ìŒ + Output ë§ìŒ = í•œ ê³³ì—ì„œ ì—¬ëŸ¬ ê³³ìœ¼ë¡œ
[A:1000â‚¿] â†’ [B:200â‚¿][C:300â‚¿][D:100â‚¿][E:399â‚¿] + 1â‚¿ ìˆ˜ìˆ˜ë£Œ
```

- **ì—°ê´€ë„**: `output_count` (1.0), `max_output_ratio` (0.9)
- **ì˜ë¯¸**: ëŒ€ëŸ‰ ìì‚°ì„ ë¶„ì‚°ì‹œí‚¤ëŠ” íŒ¨í„´

#### 3. **ê¸‰í–‰í˜• ê³ ë˜** (Express Whale)

```
ë†’ì€ ìˆ˜ìˆ˜ë£Œ = ë¹ ë¥¸ ì²˜ë¦¬ ì›í•¨
[A:1000â‚¿] â†’ [B:995â‚¿] + 5â‚¿ ìˆ˜ìˆ˜ë£Œ (ì¼ë°˜ì  0.1â‚¿ì˜ 50ë°°!)
```

- **ì—°ê´€ë„**: `fee` (1.0)
- **ì˜ë¯¸**: ì†ë„ë¥¼ ìœ„í•´ ë†’ì€ ìˆ˜ìˆ˜ë£Œ ì§€ë¶ˆ

#### 4. **ì§‘ì¤‘í˜• ê³ ë˜** (Focused Whale)

```
ì§‘ì¤‘ë„ ë†’ìŒ = ëŒ€ë¶€ë¶„ì„ í•œ ê³³ìœ¼ë¡œ
[A:1000â‚¿] â†’ [B:999â‚¿][C:0.9â‚¿] + 0.1â‚¿ ìˆ˜ìˆ˜ë£Œ (ì§‘ì¤‘ë„: 99.9%)
```

- **ì—°ê´€ë„**: `max_output_ratio` (1.0)
- **ì˜ë¯¸**: ëŒ€ë¶€ë¶„ ê¸ˆì•¡ì„ í•œ ì£¼ì†Œë¡œ ì§‘ì¤‘

#### 5. **ê±°ëŒ€í˜• ê³ ë˜** (Mega Whale)

```
ê±°ë˜ëŸ‰ ìì²´ê°€ ì••ë„ì 
[A:10000â‚¿] â†’ [B:9999â‚¿] + 1â‚¿ ìˆ˜ìˆ˜ë£Œ
```

- **ì—°ê´€ë„**: `total_input_value`, `total_output_value` (1.0)
- **ì˜ë¯¸**: ì‹œì¥ì— í° ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆëŠ” ê·œëª¨

---

## ğŸ”„ ë°ì´í„° ë³€í™˜ ê³¼ì •

### Step 1: ë°ì´í„° ë¡œë“œ ë° ë‹¨ìœ„ ë³€í™˜

```python
# ì›ë³¸ ë°ì´í„° ë¡œë“œ
df = pd.read_csv('data/1000btc.csv')

# Satoshi â†’ BTC ë³€í™˜ (1 BTC = 100,000,000 satoshi)
df['total_output_btc'] = df['total_output_value'] / 100000000
df['total_input_btc'] = df['total_input_value'] / 100000000
df['fee_btc'] = df['fee'] / 100000000
df['max_output_btc'] = df['max_output_value'] / 100000000
```

### Step 2: í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§

```python
# ì´ ê±°ë˜ëŸ‰ ê³„ì‚° (Inputê³¼ Output ì¤‘ ìµœëŒ€ê°’)
df['total_volume_btc'] = df[['total_input_btc', 'total_output_btc']].max(axis=1)

# ì§‘ì¤‘ë„ ëª…í™•í™” (ê¸°ì¡´ ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½)
df['concentration'] = df['max_output_ratio']
```

### Step 3: ê±°ë˜ í–‰ë™ íŒ¨í„´ ë¶„ë¥˜

```python
def classify_whale_behavior(row):
    # ë¶„ë¥˜ ê¸°ì¤€ ì„ê³„ê°’
    volume_p99 = df['total_volume_btc'].quantile(0.99)  # ìƒìœ„ 1%
    volume_median = df['total_volume_btc'].median()     # ì¤‘ì•™ê°’
    input_p80 = df['input_count'].quantile(0.80)       # ìƒìœ„ 20%
    output_p85 = df['output_count'].quantile(0.85)     # ìƒìœ„ 15%
    fee_p95 = df['fee_btc'].quantile(0.95)             # ìƒìœ„ 5%

    # ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ë¶„ë¥˜
    if row['total_volume_btc'] >= volume_p99:
        return 4  # ê±°ëŒ€í˜• ê³ ë˜
    elif row['fee_btc'] >= fee_p95:
        return 2  # ê¸‰í–‰í˜• ê³ ë˜
    elif row['input_count'] >= input_p80 and row['output_count'] <= 2:
        return 0  # ìˆ˜ì§‘í˜• ê³ ë˜
    elif row['output_count'] >= output_p85 and row['concentration'] < 0.8:
        return 1  # ë¶„ì‚°í˜• ê³ ë˜
    elif row['concentration'] > 0.99 and row['total_volume_btc'] > volume_median:
        return 3  # ì§‘ì¤‘í˜• ê³ ë˜
    else:
        return 3  # ì§‘ì¤‘í˜• ê³ ë˜ (ê¸°ë³¸ê°’)

df['whale_class'] = df.apply(classify_whale_behavior, axis=1)
```

### Step 4: ìµœì¢… ë°ì´í„°ì…‹ êµ¬ì„±

```python
# ìµœì¢… í”¼ì²˜ ì„ íƒ
feature_cols = [
    'total_volume_btc',    # ì´ ê±°ë˜ëŸ‰ (ì—°ê´€ë„: 1.0)
    'input_count',         # ì…ë ¥ ê°œìˆ˜ (ì—°ê´€ë„: 1.0)
    'output_count',        # ì¶œë ¥ ê°œìˆ˜ (ì—°ê´€ë„: 1.0)
    'concentration',       # ì§‘ì¤‘ë„ (ì—°ê´€ë„: 0.9)
    'fee_btc'              # ìˆ˜ìˆ˜ë£Œ (ì—°ê´€ë„: 1.0)
]

X = df[feature_cols]
y = df['whale_class']
```

---

## ğŸ“Š ë³€í™˜ ê²°ê³¼ ë¹„êµ

### ì›ë³¸ ë°ì´í„° (1000btc.csv)

```
ì»¬ëŸ¼ ìˆ˜: 11ê°œ
ë°ì´í„° ìˆ˜: 888,942ê±´
í˜•íƒœ: Raw blockchain data
ë‹¨ìœ„: Satoshi (1â‚¿ = 100,000,000 satoshi)
ëª©ì : ì¼ë°˜ì ì¸ ë¶„ì„ìš©
```

### ìµœì í™” ë°ì´í„°ì…‹ (optimized_whale_dataset.csv)

```
ì»¬ëŸ¼ ìˆ˜: 8ê°œ (í”¼ì²˜ 5ê°œ + ë¼ë²¨ 3ê°œ)
ë°ì´í„° ìˆ˜: 888,942ê±´
í˜•íƒœ: Feature engineered data
ë‹¨ìœ„: BTC (ì‚¬ìš©ì ì¹œí™”ì )
ëª©ì : Random Forest ê±°ë˜ í–‰ë™ íŒ¨í„´ ë¶„ë¥˜
```

---

## ğŸ” ì»¬ëŸ¼ ë³€í™˜ ë§¤í•‘

| ì›ë³¸ ì»¬ëŸ¼            | ë³€í™˜ í›„            | ë³€í™˜ ë°©ë²•               | ì—°ê´€ë„  |
| -------------------- | ------------------ | ----------------------- | ------- |
| `tx_hash`            | **ì œê±°**           | ì‹ë³„ìë¼ì„œ MLì— ë¶ˆí•„ìš”  | -       |
| `block_timestamp`    | **ì œê±°**           | ì‹œê°„ ì •ë³´ ë¶ˆí•„ìš”        | -       |
| `input_count`        | `input_count`      | ê·¸ëŒ€ë¡œ ìœ ì§€             | **1.0** |
| `output_count`       | `output_count`     | ê·¸ëŒ€ë¡œ ìœ ì§€             | **1.0** |
| `total_input_value`  | `total_volume_btc` | max(input,output) / 1e8 | **1.0** |
| `total_output_value` | `total_volume_btc` | max(input,output) / 1e8 | **1.0** |
| `fee`                | `fee_btc`          | / 100000000             | **1.0** |
| `max_output_value`   | **ì œê±°**           | ì§‘ì¤‘ë„ ê³„ì‚°ì—ë§Œ ì‚¬ìš©    | **1.0** |
| `max_input_value`    | **ì œê±°**           | ì‚¬ìš© ì•ˆí•¨               | **1.0** |
| `max_output_ratio`   | `concentration`    | ì´ë¦„ ë³€ê²½               | **0.9** |
| `fee_per_max_ratio`  | **ì œê±°**           | ì‚¬ìš© ì•ˆí•¨               | **0.7** |
| **ì‹ ê·œ**             | `whale_class`      | í–‰ë™ íŒ¨í„´ ë¶„ë¥˜ (0-4)    | **1.0** |
| **ì‹ ê·œ**             | `class_name`       | í•œê¸€ ë¼ë²¨ëª…             | **1.0** |
| **ì‹ ê·œ**             | `class_weight`     | ìµœì  ê°€ì¤‘ì¹˜             | **1.0** |

---

## ğŸ¯ ìµœì í™” íš¨ê³¼

### 1. **ë°ì´í„° í’ˆì§ˆ í–¥ìƒ**

- âœ… **ë‹¨ìœ„ í†µì¼**: Satoshi â†’ BTC (í•´ì„ ìš©ì´)
- âœ… **ë…¸ì´ì¦ˆ ì œê±°**: ë¶ˆí•„ìš”í•œ ì»¬ëŸ¼ ì œê±°
- âœ… **í”¼ì²˜ ì§‘ì¤‘**: ê±°ë˜ í–‰ë™ íŒ¨í„´ ê´€ë ¨ í”¼ì²˜ë§Œ ì„ íƒ

### 2. **ë¨¸ì‹ ëŸ¬ë‹ ì„±ëŠ¥ í–¥ìƒ**

- âœ… **í´ë˜ìŠ¤ ë¼ë²¨ë§**: ì‹¤ì œ ê±°ë˜ í–‰ë™ íŒ¨í„´ ê¸°ë°˜
- âœ… **Class Weight ìµœì í™”**: í¬ê·€ë„ ê¸°ë°˜ ê°€ì¤‘ì¹˜ (16.9% ì„±ëŠ¥ í–¥ìƒ)
- âœ… **ê³¼ì í•© ë°©ì§€**: í•µì‹¬ í”¼ì²˜ë§Œ ì„ íƒ

### 3. **ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜ ì¦ëŒ€**

- âœ… **í•´ì„ ê°€ëŠ¥ì„±**: ê±°ë˜ íŒ¨í„´ë³„ ëª…í™•í•œ ì˜ë¯¸
- âœ… **ì‹¤ìš©ì„±**: Random Forest ëª¨ë¸ì— ìµœì í™”
- âœ… **í™•ì¥ì„±**: ìƒˆë¡œìš´ ë°ì´í„° ì ìš© ê°€ëŠ¥

---

## ğŸ“ˆ ì‚¬ìš© ì˜ˆì‹œ

### ë°ì´í„° ë¡œë“œ

```python
import pandas as pd

# ìµœì í™”ëœ ë°ì´í„°ì…‹ ë¡œë“œ
df = pd.read_csv('analysis/step1_results/class_weight_results/optimized_whale_dataset.csv')

# í”¼ì²˜ì™€ ë¼ë²¨ ë¶„ë¦¬
features = ['total_volume_btc', 'input_count', 'output_count', 'concentration', 'fee_btc']
X = df[features]
y = df['whale_class']
class_weights = df.set_index('whale_class')['class_weight'].drop_duplicates().to_dict()
```

### ëª¨ë¸ í›ˆë ¨

```python
from sklearn.ensemble import RandomForestClassifier

# ìµœì  ì„¤ì •ìœ¼ë¡œ ëª¨ë¸ í›ˆë ¨
model = RandomForestClassifier(
    n_estimators=100,
    random_state=42,
    class_weight=class_weights,  # ìµœì í™”ëœ ê°€ì¤‘ì¹˜ ì‚¬ìš©
    max_depth=8,
    min_samples_split=50,
    min_samples_leaf=20,
    max_features='sqrt'
)

model.fit(X, y)
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### Q1: ì™œ ì¼ë¶€ ì»¬ëŸ¼ì´ ì œê±°ë˜ì—ˆë‚˜ìš”?

**A**: ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì˜ ì„±ëŠ¥ê³¼ í•´ì„ ê°€ëŠ¥ì„±ì„ ìœ„í•´ ë…¸ì´ì¦ˆê°€ ë  ìˆ˜ ìˆëŠ” ì»¬ëŸ¼ë“¤ì„ ì œê±°í–ˆìŠµë‹ˆë‹¤.

- `tx_hash`: ì‹ë³„ìë¡œ íŒ¨í„´ í•™ìŠµì— ë¬´ì˜ë¯¸
- `block_timestamp`: ì‹œê°„ ì •ë³´ëŠ” ì´ë²ˆ ë¶„ì„ì—ì„œ ë¶ˆí•„ìš”
- `max_output_value`, `max_input_value`: ì§‘ì¤‘ë„ ê³„ì‚°ì—ë§Œ ì‚¬ìš©

### Q2: ì—°ê´€ë„ 0~1ì€ ì–´ë–»ê²Œ ê³„ì‚°í–ˆë‚˜ìš”?

**A**: ë¹„íŠ¸ì½”ì¸ íŠ¸ëœì­ì…˜ êµ¬ì¡°ì™€ì˜ ì§ì ‘ì  ì—°ê´€ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€:

- **1.0**: íŠ¸ëœì­ì…˜ì—ì„œ ì§ì ‘ ì¶”ì¶œë˜ëŠ” ê°’
- **0.9**: ì§ì ‘ ê°’ë“¤ë¡œ ê³„ì‚°ëœ ë¹„ìœ¨ (max_output_ratio)
- **0.7**: 2ì°¨ íŒŒìƒ ì§€í‘œ (fee_per_max_ratio)

### Q3: ì›ë³¸ ë°ì´í„°ë„ í•„ìš”í•œê°€ìš”?

**A**: ìš©ë„ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤:

- **ê±°ë˜ í–‰ë™ íŒ¨í„´ ë¶„ë¥˜**: ìµœì í™”ëœ ë°ì´í„°ì…‹ ì‚¬ìš©
- **ì‹œê³„ì—´ ë¶„ì„**: ì›ë³¸ ë°ì´í„°ì˜ `block_timestamp` í•„ìš”
- **íŠ¸ëœì­ì…˜ ì¶”ì **: ì›ë³¸ ë°ì´í„°ì˜ `tx_hash` í•„ìš”

---

## ğŸ“ ê²°ë¡ 

ì´ ë³€í™˜ ê³¼ì •ì„ í†µí•´ **ì›ë³¸ ë¸”ë¡ì²´ì¸ ë°ì´í„°**ë¥¼ **Random Forest ê¸°ë°˜ ê³ ë˜ ê±°ë˜ í–‰ë™ íŒ¨í„´ ë¶„ë¥˜**ì— ìµœì í™”ëœ í˜•íƒœë¡œ ì„±ê³µì ìœ¼ë¡œ ë³€í™˜í–ˆìŠµë‹ˆë‹¤.

**í•µì‹¬ ì„±ê³¼**:

- ğŸ“Š **16.9% ì„±ëŠ¥ í–¥ìƒ** (F1-Score: 0.5081)
- ğŸ¯ **ì‹¤ì œ ê±°ë˜ íŒ¨í„´ ê¸°ë°˜** ë¶„ë¥˜ ì²´ê³„ êµ¬ì¶•
- ğŸš€ **ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ** ìµœì í™”ëœ ë°ì´í„°ì…‹ ì œê³µ
